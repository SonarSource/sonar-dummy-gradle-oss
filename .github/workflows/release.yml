name: sonar-release

on:
  push:
    branches:
      - "test/vault-aws-staging"

jobs:
  release:
    runs-on: ubuntu-latest
    name: Release
    permissions:
      id-token: write
      contents: read
    env:
      VAULT_ADDR: https://vault.staging.sonar.build:8200
    steps:
      - name: Vault Secrets
        id: secrets
        uses: hashicorp/vault-action@7d98524254c38dc6892804f991526ff30905f643 # tag=v2.4.2
        with:
          url: ${{ env.VAULT_ADDR }}
          exportEnv: false
          method: jwt
          path: jwt-ghwf
          role: github-sonarsource-sonar-dummy-oss
          secrets: |
            development/aws/sts/downloads access_key | binaries_aws_access_key_id;
            development/aws/sts/downloads secret_key | binaries_aws_secret_access_key;
            development/aws/sts/downloads security_token | binaries_aws_security_token;
